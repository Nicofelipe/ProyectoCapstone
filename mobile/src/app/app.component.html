<ion-app>
  <!-- Men√∫ lateral -->
  <ion-menu contentId="main" type="overlay">
    <ion-header>
      <ion-toolbar>
        <ion-title style="color:#2b2b2b;">Cambioteca</ion-title>
      </ion-toolbar>
    </ion-header>

    <ion-content>
      <!-- Cabecera de usuario -->
      <div class="menu-user" *ngIf="user as u; else guestHeader" (click)="goProfile()">
        <ion-avatar class="menu-avatar">
          <img [src]="avatarUrl(u)" alt="avatar" />
        </ion-avatar>
        <div class="menu-user-info">
          <div class="name">{{ displayName(u) }}</div>
          <div class="email">{{ u.email }}</div>
        </div>
        <ion-ripple-effect></ion-ripple-effect>
      </div>

      <ng-template #guestHeader>
        <div class="menu-user guest">
          <ion-avatar class="menu-avatar">
            <img [src]="avatarUrl(null)" alt="avatar" />
          </ion-avatar>
          <div class="menu-user-info">
            <div class="name">Invitado</div>
            <div class="email">Bienvenido a Cambioteca</div>
          </div>
        </div>
      </ng-template>

      <!-- üëá a√±ade la clase para estilizar √≠tems -->
      <ion-list class="menu-list">


        <ion-menu-toggle auto-hide="true" *ngFor="let it of visibleItems">
          <ion-item [routerLink]="it.redirectTo" routerLinkActive="activated" detail="true">
            <ion-icon slot="start" [name]="it.icon"></ion-icon>
            <ion-label>{{ it.name }}</ion-label>

            <!-- üî¥ Puntito en el men√∫ solo para "Solicitudes" -->
            <span *ngIf="it.redirectTo === '/requests' && hasPendingRequests" class="notif-dot">
            </span>
          </ion-item>
        </ion-menu-toggle>

      </ion-list>
    </ion-content>

    <!-- üëá acciones ancladas abajo, tipograf√≠a m√°s peque√±a -->
    <ion-footer *ngIf="user" class="menu-footer">
      <ion-toolbar>
        <div class="menu-actions">
          <ion-button expand="block" size="small" class="btn-logout" (click)="logout()">
            <ion-icon slot="start" name="log-out-outline"></ion-icon>
            Cerrar sesi√≥n (este dispositivo)
          </ion-button>

          <ion-button expand="block" size="small" class="btn-logout-all" (click)="logoutAll()">
            <ion-icon slot="start" name="lock-closed-outline"></ion-icon>
            Cerrar en todos los dispositivos
          </ion-button>
        </div>
      </ion-toolbar>
    </ion-footer>
  </ion-menu>

  <!-- Contenido principal -->
  <!-- ...men√∫ igual... -->

  <div class="app-shell" [class.footer-visible]="footerVisible" [class.has-tabbar]="!!user">
    <ion-router-outlet id="main"></ion-router-outlet>

    <footer class="global-footer">
      <div class="footer-inner">
        <h4 class="brand">Cambioteca</h4>
        <div class="social">
          <ion-button fill="clear" size="small">
            <ion-icon slot="start" name="logo-instagram"></ion-icon> Instagram
          </ion-button>
          <ion-button fill="clear" size="small">
            <ion-icon slot="start" name="logo-facebook"></ion-icon> Facebook
          </ion-button>
          <ion-button fill="clear" size="small">
            <ion-icon slot="start" name="logo-twitter"></ion-icon> X/Twitter
          </ion-button>
        </div>
      </div>
    </footer>




    <!-- ===== Barra inferior m√≥vil (solo logueado) ===== -->
    <nav class="mobile-tabbar" *ngIf="user">
      <!-- üë§ Barra para usuario normal -->
      <ng-container *ngIf="!user?.es_admin; else adminTabbar">
        <button class="tab" routerLink="/home" aria-label="Inicio">
          <ion-icon name="home-outline"></ion-icon>
          <span>Inicio</span>
        </button>

        <button class="tab" routerLink="/my-books" aria-label="Mis Libros">
          <ion-icon name="book-outline"></ion-icon>
          <span>Mis Libros</span>
        </button>

        <!-- Bot√≥n central: A√±adir libro -->
        <button class="add" (click)="onAddBook()" aria-label="A√±adir libro">
          <ion-icon name="add"></ion-icon>
        </button>

        <button class="tab" routerLink="/requests" aria-label="Solicitudes">
          <span class="tab-icon-wrapper">
            <ion-icon name="swap-horizontal-outline"></ion-icon>
            <!-- üî¥ Puntito rojo sobre el √≠cono -->
            <span *ngIf="hasPendingRequests" class="notif-dot notif-dot--tab"></span>
          </span>
          <span>Solicitudes</span>
        </button>

        <button class="tab" routerLink="/profile" aria-label="Mi Perfil">
          <ion-icon name="person-outline"></ion-icon>
          <span>Mi Perfil</span>
        </button>
      </ng-container>

      <!-- üõ°Ô∏è Barra especial para ADMIN -->
      <ng-template #adminTabbar>
        <button class="tab" routerLink="/admin/dashboard" aria-label="Dashboard">
          <ion-icon name="stats-chart-outline"></ion-icon>
          <span>Dashboard</span>
        </button>

        <button class="tab" routerLink="/admin/users" aria-label="Usuarios">
          <ion-icon name="people-outline"></ion-icon>
          <span>Usuarios</span>
        </button>

        <button class="tab" routerLink="/admin/reports" aria-label="Reportes">
          <ion-icon name="flag-outline"></ion-icon>
          <span>Reportes</span>
        </button>
      </ng-template>
    </nav>


  </div>
</ion-app>